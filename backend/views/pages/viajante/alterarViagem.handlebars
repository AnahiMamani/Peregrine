{{> headerUsuario}}
<main>
    <form class="container" id="alterarViagemForm">

        <!-- espaço para inserção do título e subtítulo da viagem -->
        <div class="row text-center">
            <!-- input para título da viagem -->
            <input type="text" name="tituloViagem" id="tituloViagem" placeholder="{{viagem.A03_TITULO}}"
                class="border-2 fs-1 text-center rounded-4">

            <!-- input para subtítulo da viagem -->
            <input type="text" name="subtituloViagem" id="subtituloViagem" placeholder="{{viagem.A03_SUBTITULO}}"
                class="my-4 container text-center rounded-4 border border-2 border-secondary" style="height: 4rem;">
            <div class="my-4 container text-center rounded-4 border border-2 border-secondary" style="height: 6rem;">
                <div class="d-flex align-items-center mb-2">
                    <h4 class="m-0">Link de grupo externo</h4>
                    <img id="infoIcon" src="/images/icon-informacao.png" alt="Ícone de informação"
                        style="width: 1.5rem; height: 1.5rem; margin-left: 0.5rem;">
                    <input type="text" name="linkgrupo" id="linkgrupo" placeholder="{{viagem.A03_LINK}}"
                        class="my-4 container text-center rounded-4 border border-2 border-secondary"
                        style="height: 3rem;width: 40rem;">
                </div>
            </div>
        </div>

        <!-- espaço para inserção das principais informações da viagem -->
        <div class="row my-4 container text-center rounded-4 border border-2 border-secondary" style="width: 90vw;">
            <div class="container my-4">
                <!-- Linha contendo as 4 colunas -->
                <div class="row justify-content-center">
                    <!-- Primeira coluna - Origem -->
                    <div class="col-12 col-md-3 p-4 my-4 d-flex flex-column align-items-center">
                        <div class="d-flex align-items-center mb-2">
                            <img src="/images/icon-origem-localizacao.png" alt="Ícone de localização"
                                style="width: 1.5rem; height: 1.5rem; margin-right: 0.5rem;">
                            <h4 class="m-0">Origem</h4>
                        </div>
                        <input type="text" name="origemViagem" id="origemViagem" placeholder="{{viagem.A03_ORIGEM}}"
                            class="form-control text-center rounded-4" style="height: 2.5rem;">
                    </div>

                    <!-- Segunda coluna - Destino -->
                    <div class="col-12 col-md-3 p-4 my-4 d-flex flex-column align-items-center">
                        <div class="d-flex align-items-center mb-2">
                            <img src="/images/icon-destino-mundo.png" alt="Ícone de mundo - localização"
                                style="width: 1.5rem; height: 1.5rem; margin-right: 0.5rem;">
                            <h4 class="m-0">Destino</h4>
                        </div>
                        <input type="text" name="destinoViagem" id="destinoViagem" placeholder="{{viagem.A03_DESTINO}}"
                            class="form-control text-center rounded-4" style="height: 2.5rem;">
                    </div>

                    <!-- Terceira coluna - Vagas -->
                    <div class="col-12 col-md-3 p-4 my-4 d-flex flex-column align-items-center">
                        <div class="d-flex align-items-center mb-2">
                            <img src="/images/icon-perfilPreto.png" alt="Ícone de mulher - pessoa"
                                style="width: 1.5rem; height: 1.5rem; margin-right: 0.5rem;">
                            <h4 class="m-0">Vagas</h4>
                        </div>
                        <input type="number" name="vagasViagem" id="vagasViagem" placeholder="{{viagem.A03_VAGAS}}"
                            class="form-control text-center rounded-4" style="height: 2.5rem;">
                    </div>

                    <!-- Quarta coluna - Custo -->
                    <div class="col-12 col-md-3 p-4 my-4 d-flex flex-column align-items-center">
                        <div class="d-flex align-items-center mb-2">
                            <img src="/images/icon-dinheiro.png" alt="Ícone de dinheiro"
                                style="width: 1.5rem; height: 1.5rem; margin-right: 0.5rem;">
                            <h4 class="m-0">Custo estimado</h4>
                        </div>
                        <input type="number" name="custoViagem" id="custoViagem" placeholder="{{viagem.A03_CUSTO}}"
                            class="form-control text-center rounded-4" style="height: 2.5rem;">
                    </div>
                </div>

                <!-- Campo para o período de viagem -->
                <div class="row justify-content-center">
                    <!-- Campo de ida e volta -->
                    <div class="col-12 col-md-6 p-4 my-4">
                        <div class="d-flex align-items-center justify-content-center px-2 mb-2">
                            <h4 class="m-0 me-5">Ida</h4>
                            <div class="d-flex align-items-center" style="margin-left: 130px;">
                                <h4 class="m-0">Embarque</h4>
                                <img src="/images/icon-data.png" alt="Ícone de data - calendário" class="mx-2"
                                    style="width: 1.5rem; height: 1.5rem;">
                                <h4 class="m-0">Horário</h4>
                            </div>
                        </div>
                        <div class="input-group">
                            <input type="text" name="localIdaViagem" id="localIdaViagem"
                                placeholder="{{viagem.A03_LOCAL_IDA}}" class="form-control text-center rounded-start-4"
                                style="height: 2.5rem; flex: 2;">
                            <input type="date" name="dataIdaViagem" id="dataIdaViagem"
                                placeholder="{{viagem.A03_DATA_IDA}}" class="form-control text-center"
                                style="height: 2.5rem; flex: 1;">
                            <input type="time" name="horaIdaViagem" id="horaIdaViagem"
                                placeholder="{{viagem.A03_HORA_IDA}}0" class="form-control text-center rounded-end-4"
                                style="height: 2.5rem; flex: 1;">
                        </div>
                    </div>

                    <!-- Campo de volta -->
                    <div class="col-12 col-md-6 p-4 my-4">
                        <div class="d-flex align-items-center justify-content-center px-2 mb-2">
                            <h4 class="m-0 me-5">Volta</h4>
                            <div class="d-flex align-items-center" style="margin-left: 100px;">
                                <h4 class="m-0">Embarque</h4>
                                <img src="/images/icon-data.png" alt="Ícone de data - calendário" class="mx-2"
                                    style="width: 1.5rem; height: 1.5rem;">
                                <h4 class="m-0">Horário</h4>
                            </div>
                        </div>
                        <div class="input-group">
                            <input type="text" name="localVoltaViagem" id="localVoltaViagem"
                                placeholder="{{viagem.A03_LOCAL_VOLTA}}"
                                class="form-control text-center rounded-start-4" style="height: 2.5rem; flex: 2;">
                            <input type="date" name="dataVoltaViagem" id="dataVoltaViagem"
                                placeholder="{{viagem.A03_DATA_VOLTA}}" class="form-control text-center"
                                style="height: 2.5rem; flex: 1;">
                            <input type="time" name="horaVoltaViagem" id="horaVoltaViagem"
                                placeholder="{{viagem.A03_HORA_VOLTA}}0" class="form-control text-center rounded-end-4"
                                style="height: 2.5rem; flex: 1;">
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- espaço para inserção do texto descritivo da viagem -->
        <textarea name="descricaoViagem" id="descricaoViagem" placeholder="{{viagem.A03_DESCRICAO}}"
            class="my-4 container rounded-4 border border-2 border-secondary"
            style="height: 40rem; width: 80vw; padding: 2rem;"></textarea>

        <div class="row">
            <div class="col">
                &nbsp;
            </div>
        </div>
        <div class="row">
            <div class="col">
                &nbsp;
            </div>
        </div>

        <!-- o botão abaixo abre uma janela no js para confirmação da alteração da viagem-->
        <div class="d-flex align-items-center justify-content-center">
            <button type="button" class="btn btn-primary" id="confirmaalteracao" style="width: 20rem;">Salvar
                alterações</button>
        </div>
        <div class="d-flex align-items-center justify-content-center">
            <a id="exclusao" class="linkcadastro"
                style="margin-top: 20px; margin-bottom: 5rem; background: none; border: none; color: #99067E; cursor: pointer;">
                Excluir viagem?
            </a>
        </div>
    </form>
</main>
{{> footer }}
<!-- link bootstrap icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.min.css">
{{!--
<script src="/scripts/excluirViagem.js"></script> --}}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Seleciona o botão de excluir viagem pelo ID correto
        const btnExcluirViagem = document.getElementById('exclusao');

        btnExcluirViagem.addEventListener('click', () => {
            // Cria a estrutura HTML da janela de confirmação
            const overlay = document.createElement('div');
            overlay.id = 'confirmOverlay';
            overlay.className = 'confirm-overlay';
            overlay.innerHTML = `
            <div class="confirm-box">
                <h4>Você tem certeza que deseja excluir a viagem?</h4>
                <p>Essa ação não poderá ser desfeita.</p>
                <div class="confirm-buttons">
                    <button class="btn btn-secondary btn-confirmar-nao">Não, quero voltar</button>
                    <button class="btn btn-primary btn-confirmar-sim">Sim, excluir viagem</button>
                </div>
            </div>
        `;

            // Adiciona a janela ao body
            document.body.appendChild(overlay);

            // Fecha a janela ao clicar no botão "Não, quero voltar"
            overlay.querySelector('.btn-confirmar-nao').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });

            // Envia requisição de exclusão ao clicar no botão "Sim, excluir viagem"
            overlay.querySelector('.btn-confirmar-sim').addEventListener('click', async () => {
                const viagemId = /* Aqui você pega o ID da viagem dinamicamente, talvez do próprio URL */
                    window.location.pathname.split('/')[2]; // Exemplo: obtém o ID da URL '/viagem/alterar/16'

                try {
                    // Fazendo requisição DELETE
                    const response = await fetch(`/control/viagem-delete/{{viagem.A03_ID}}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        window.location.href = '/viagem/exclusao-concluida';
                    } else {
                        alert('Erro ao excluir a viagem');
                        document.body.removeChild(overlay);
                    }
                } catch (error) {
                    alert('Erro ao excluir a viagem');
                    console.error(error);
                    document.body.removeChild(overlay);
                }
            });
        });
    });



    document.addEventListener('DOMContentLoaded', () => {
        const btnAlterarViagem = document.getElementById('confirmaalteracao');
        const form = document.getElementById('alterarViagemForm');

        btnAlterarViagem.addEventListener('click', () => {
            // Cria a janela de confirmação
            const overlay = document.createElement('div');
            overlay.id = 'confirmOverlay';
            overlay.className = 'confirm-overlay';
            overlay.innerHTML = `
            <div class="confirm-box">
                <h4>Deseja salvar alterações?</h4>
                <div class="confirm-buttons">
                    <button class="btn btn-secondary btn-confirmar-nao">Não, quero voltar</button>
                    <button class="btn btn-primary btn-confirmar-sim">Sim, salvar</button>
                </div>
            </div>
        `;

            // Adiciona a janela ao body
            document.body.appendChild(overlay);

            // Fecha a janela ao clicar no botão "Não, quero voltar"
            overlay.querySelector('.btn-confirmar-nao').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });

            // Submete o formulário ao clicar no botão "Sim, salvar"
            overlay.querySelector('.btn-confirmar-sim').addEventListener('click', async () => {
                // Captura os valores do formulário
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                // Substitui quebras de linha por <br> no campo de descrição
                if (data.descricaoViagem) {
                    data.descricaoViagem = data.descricaoViagem.replace(/\n/g, '<br>');
                }

                try {
                    const response = await fetch('/control/viagem-update/{{viagem.A03_ID}}', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data),
                    });

                    if (response.ok) {
                        // Redireciona após o sucesso
                        window.location.href = '/viagem/alteracao-concluida';
                    } else {
                        alert('Erro ao salvar alterações. Tente novamente.');
                    }
                } catch (error) {
                    console.error('Erro:', error);
                    alert('Erro ao salvar alterações.');
                }

                // Remove a janela de confirmação
                document.body.removeChild(overlay);
            });
        });
    });

</script>